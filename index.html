<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Strålespidserne – Demo v0.1</title>
<style>
  body {
    margin: 0; background: #222; overflow: hidden; font-family: monospace;
    color: white;
  }
  #gameCanvas {
    background: #7ec850; /* grøn bygrund */
    display: block;
    margin: auto;
    border: 4px solid #444;
  }
  #infoPanel {
    position: absolute;
    top: 8px;
    left: 8px;
    background: rgba(0,0,0,0.7);
    padding: 6px 10px;
    border-radius: 6px;
    max-width: 300px;
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="640" height="480"></canvas>
<div id="infoPanel">
  <h2>Strålespidserne – Demo v0.1</h2>
  <p>Brug WASD eller piletaster til at køre på knallert.</p>
  <p>Mål: Kom til værtshuset og tryk [E] for at gå ind.</p>
  <p>Du kan møde banderne: Strålespidserne, Teufelskerle, Rusthovederne og Kobberbøsserne.</p>
  <p><b>Mission:</b> Find Villy på værtshuset og stjæl en reservedel fra Teufelskerle.</p>
  <p>Status: <span id="status">Klar</span></p>
</div>

<script>
// --- KONSTANTER ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const width = canvas.width;
const height = canvas.height;

// --- SPILLERKNALLERT ---
const knallertSprites = {
  yamahaFS1: '#f0a500',
  simsonS51: '#e63946',
  puchVz50: '#457b9d',
  puchMaxi: '#2a9d8f'
};

// Valgt knallert
let spillerKnallert = 'yamahaFS1';

// --- BANDE INFO ---
const bander = {
  'Strålespidserne': { color: '#4caf50', baseX: 100, baseY: 380 },
  'Teufelskerle': { color: '#b71c1c', baseX: 540, baseY: 80 },
  'Rusthovederne': { color: '#6d4c41', baseX: 300, baseY: 250 },
  'Kobberbøsserne': { color: '#f57c00', baseX: 500, baseY: 420 }
};

// --- BY KORT (for demo simplificeret) ---
const cityZones = [
  {name: 'Parcelhuskvarteret', x: 0, y: 320, w: 320, h: 160, color: '#7ec850'},
  {name: 'Industrikvarteret', x: 320, y: 200, w: 320, h: 120, color: '#a1a1a1'},
  {name: 'Centrum', x: 320, y: 320, w: 320, h: 160, color: '#8b4513'},
  {name: 'Sydhavnen', x: 0, y: 0, w: 320, h: 200, color: '#355e8b'}
];

// --- Spilleren ---
let spiller = {
  x: bander['Strålespidserne'].baseX,
  y: bander['Strålespidserne'].baseY,
  width: 24,
  height: 12,
  speed: 2.5,
  angle: 0,
  knallert: spillerKnallert,
  inPub: false,
  drunk: 0
};

// --- Input ---
const keys = {};
window.addEventListener('keydown', e => {
  keys[e.key.toLowerCase()] = true;
});
window.addEventListener('keyup', e => {
  keys[e.key.toLowerCase()] = false;
});

// --- Værtshuset ---
const pub = {
  x: 540,
  y: 400,
  width: 80,
  height: 60,
  color: '#593d12',
  doorX: 580,
  doorY: 450,
  inside: false
};

// --- Mission State ---
let missionState = 'findVilly'; // demo simplificeret

// --- Funktion: tegn spillerknallert ---
function drawSpiller() {
  ctx.save();
  ctx.translate(spiller.x, spiller.y);
  ctx.rotate(spiller.angle);
  ctx.fillStyle = knallertSprites[spiller.knallert];
  ctx.fillRect(-spiller.width/2, -spiller.height/2, spiller.width, spiller.height);
  // Hjul
  ctx.fillStyle = '#222';
  ctx.fillRect(-spiller.width/2+2, spiller.height/2-4, 6, 4);
  ctx.fillRect(spiller.width/2-8, spiller.height/2-4, 6, 4);
  ctx.restore();
}

// --- Funktion: tegn by ---
function drawCity() {
  cityZones.forEach(zone => {
    ctx.fillStyle = zone.color;
    ctx.fillRect(zone.x, zone.y, zone.w, zone.h);
    ctx.strokeStyle = '#000';
    ctx.strokeRect(zone.x, zone.y, zone.w, zone.h);
    ctx.fillStyle = '#000';
    ctx.font = '12px monospace';
    ctx.fillText(zone.name, zone.x + 5, zone.y + 15);
  });

  // Tegn bandebaser
  Object.keys(bander).forEach(bande => {
    const b = bander[bande];
    ctx.fillStyle = b.color;
    ctx.beginPath();
    ctx.arc(b.baseX, b.baseY, 15, 0, 2 * Math.PI);
    ctx.fill();
    ctx.fillStyle = '#fff';
    ctx.font = '10px monospace';
    ctx.fillText(bande, b.baseX - 30, b.baseY - 20);
  });

  // Tegn værtshuset
  ctx.fillStyle = pub.color;
  ctx.fillRect(pub.x, pub.y, pub.width, pub.height);
  ctx.fillStyle = '#fff';
  ctx.font = '14px monospace';
  ctx.fillText('Det Halve Stempel', pub.x + 5, pub.y + 30);
  ctx.fillText('[E] for at gå ind', pub.x + 5, pub.y + 50);
}

// --- Funktion: opdater spiller ---
function updateSpiller() {
  if (spiller.inPub) return; // Inaktiv når i værtshus

  let speedMod = 1;
  if (spiller.drunk > 0) {
    speedMod = 0.8;
    spiller.drunk -= 0.01;
    if (spiller.drunk < 0) spiller.drunk = 0;
  }

  if (keys['w'] || keys['arrowup']) {
    spiller.x += Math.cos(spiller.angle) * spiller.speed * speedMod;
    spiller.y += Math.sin(spiller.angle) * spiller.speed * speedMod;
  }
  if (keys['s'] || keys['arrowdown']) {
    spiller.x -= Math.cos(spiller.angle) * spiller.speed * speedMod * 0.5;
    spiller.y -= Math.sin(spiller.angle) * spiller.speed * speedMod * 0.5;
  }
  if (keys['a'] || keys['arrowleft']) {
    spiller.angle -= 0.05 + spiller.drunk * 0.1;
  }
  if (keys['d'] || keys['arrowright']) {
    spiller.angle += 0.05 + spiller.drunk * 0.1;
  }

  // Begræns spiller i canvas
  if (spiller.x < 0) spiller.x = 0;
  if (spiller.y < 0) spiller.y = 0;
  if (spiller.x > width) spiller.x = width;
  if (spiller.y > height) spiller.y = height;

  // Tjek om spiller er ved værtshuset for at gå ind
  if (Math.abs(spiller.x - (pub.x + pub.width/2)) < 40 &&
      Math.abs(spiller.y - (pub.y + pub.height/2)) < 40 &&
      keys['e']) {
    spiller.inPub = true;
    missionState = 'findVilly';
    updateStatus('Du er gået ind på værtshuset. Find Villy!');
  }
}

// --- Funktion: tegner inde i værtshuset ---
function drawPubInside() {
  ctx.fillStyle = '#422d0f';
  ctx.fillRect(0, 0, width, height);
  ctx.fillStyle = '#fff';
  ctx.font = '20px monospace';
  ctx.fillText('Det Halve Stempel - Værtshuset', 20, 40);
  ctx.font = '16px monospace';
  ctx.fillText('Tryk [D] for at drikke øl', 20, 80);
  ctx.fillText('Tryk [F] for at finde Villy', 20, 110);
  ctx.fillText('Tryk [Q] for at gå ud igen', 20, 140);
}

// --- Funktion: opdater inde i værtshuset ---
function updatePub() {
  if (keys['d']) {
    spiller.drunk = Math.min(spiller.drunk + 1, 5);
    updateStatus('Du drikker en øl... Du føler dig lidt svimmel.');
    keys['d'] = false;
  }
  if (keys['f']) {
    if (missionState === 'findVilly') {
      updateStatus('Villy siger: "Stjæl en reservedel fra Teufelskerle-banden!"');
      missionState = 'missionStarted';
    } else {
      updateStatus('Du har allerede fået missionen.');
    }
    keys['f'] = false;
  }
  if (keys['q']) {
    spiller.inPub = false;
    updateStatus('Du er gået ud af værtshuset.');
    keys['q'] = false;
  }
}

// --- Funktion: opdater status tekst ---
function updateStatus(text) {
  document.getElementById('status').textContent = text;
}

// --- Main game loop ---
function gameLoop() {
  ctx.clearRect(0, 0, width, height);

  if (spiller.inPub) {
    drawPubInside();
    updatePub();
  } else {
    drawCity();
    updateSpiller();
    drawSpiller();
  }

  requestAnimationFrame(gameLoop);
}

// Start spillet
updateStatus('Klar til at spille! Kør til værtshuset og tryk [E]');
gameLoop();
</script>
</body>
</html>
